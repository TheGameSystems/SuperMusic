<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SuperMusic ‚Äî Player</title>
<style>
  :root{--bg:#071229;--card:#142033;--accent:#6ee7b7;--muted:#9aa4b2}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#07192b);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
  .player{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  .top{display:flex;gap:14px;align-items:center}
  .art{width:120px;height:120px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-size:30px;font-weight:800;color:#022}
  .meta{flex:1;min-width:0}
  .title{font-weight:800;font-size:18px;margin:0}
  .artist{color:var(--muted);margin-top:6px;font-size:13px}
  .controls{display:flex;gap:10px;margin-top:12px}
  .btn{background:var(--accent);border:none;color:#022;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:#dbeeff}
  .progress{height:10px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden;margin-top:12px;cursor:pointer}
  .bar{height:100%;background:linear-gradient(90deg,var(--accent),#60a5fa);width:0%}
  .time{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;margin-top:6px}
  .back{display:inline-block;margin-top:12px;color:var(--accent);text-decoration:none;font-weight:700}
  .message{color:#ffcccb;margin-top:10px}
  /* hide YouTube iframe (still plays audio) */
  #youtubePlayer{width:0;height:0;opacity:0;pointer-events:none}
</style>
</head>
<body>
  <div class="player">
    <div class="top">
      <div class="art" id="coverArt">??</div>
      <div class="meta">
        <div class="title" id="trackTitle">Loading...</div>
        <div class="artist" id="trackArtist"></div>

        <!-- mp3 controls -->
        <div id="mp3Controls" style="margin-top:8px">
          <div class="controls">
            <button class="btn" id="playBtn">‚ñ∂ Play</button>
            <button class="btn ghost" id="stopBtn">Stop</button>
          </div>
          <div class="progress" id="progressBar">
            <div class="bar" id="progressFill"></div>
          </div>
          <div class="time"><span id="currentTime">0:00</span><span id="duration">0:00</span></div>
        </div>

        <!-- youtube "audio only" controls -->
        <div id="youtubeContainer" class="hidden">
          <div id="youtubePlayer"></div>
          <div class="controls">
            <button class="btn" id="ytPlayPause">‚ñ∂ Play</button>
            <button class="btn ghost" id="ytRewind">‚è™ 10s</button>
            <button class="btn ghost" id="ytForward">‚è© 10s</button>
          </div>
          <div class="progress" id="ytProgressBar">
            <div class="bar" id="ytProgressFill"></div>
          </div>
          <div class="time"><span id="ytCurrentTime">0:00</span><span id="ytDuration">0:00</span></div>
        </div>
      </div>
    </div>

    <div id="message" class="message"></div>

    <a class="back" href="index.html">‚¨Ö Back to Home</a>
  </div>

  <audio id="audio" preload="metadata"></audio>

<script>
  const params = new URLSearchParams(window.location.search);
  const type = params.get('type');       
  const url = params.get('url');         
  const videoId = params.get('videoId'); 
  const source = params.get('source');   
  const titleParam = params.get('title') || '';
  const artistParam = params.get('artist') || '';

  const titleEl = document.getElementById('trackTitle');
  const artistEl = document.getElementById('trackArtist');
  const coverEl = document.getElementById('coverArt');
  const mp3Controls = document.getElementById('mp3Controls');
  const youtubeContainer = document.getElementById('youtubeContainer');
  const messageEl = document.getElementById('message');

  titleEl.textContent = decodeURIComponent(titleParam) || 'Untitled';
  artistEl.textContent = decodeURIComponent(artistParam) || '';
  coverEl.textContent = (titleEl.textContent || '??').slice(0,2).toUpperCase();

  // MP3 elements
  const audio = document.getElementById('audio');
  const playBtn = document.getElementById('playBtn');
  const stopBtn = document.getElementById('stopBtn');
  const progressBar = document.getElementById('progressBar');
  const progressFill = document.getElementById('progressFill');
  const currentTimeEl = document.getElementById('currentTime');
  const durationEl = document.getElementById('duration');

  // YouTube elements
  const ytProgressBar = document.getElementById('ytProgressBar');
  const ytProgressFill = document.getElementById('ytProgressFill');
  const ytCurrentTimeEl = document.getElementById('ytCurrentTime');
  const ytDurationEl = document.getElementById('ytDuration');

  function showMessage(txt, isError=false){
    messageEl.textContent = txt || '';
    messageEl.style.color = isError ? '#ff8b8b' : '#9aa4b2';
  }

  // ---- MP3 Flow ----
  if(type === 'mp3'){
    youtubeContainer.style.display = 'none'; // ‚úÖ hide YouTube section
    if(source === 'session'){
      const raw = sessionStorage.getItem('uploadedAudio');
      if(raw){
        const obj = JSON.parse(raw);
        audio.src = obj.dataUrl;
        initMp3Controls();
      } else {
        showMessage('No uploaded file found.', true);
      }
    } else if(url){
      audio.src = decodeURIComponent(url);
      initMp3Controls();
    } else {
      showMessage('No MP3 source.', true);
    }
  }

  // ---- YouTube Flow ----
  else if(type === 'youtube'){
  mp3Controls.style.display = 'none';
  youtubeContainer.classList.remove('hidden');

  const id = videoId || params.get('url');
  if(!id){
    showMessage('No YouTube ID provided', true);
  } else {
    // üîπ Fetch YouTube video title
    fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`)
      .then(res => res.json())
      .then(data => {
        titleEl.textContent = data.title;
        coverEl.textContent = data.title.slice(0,2).toUpperCase();
      })
      .catch(()=> showMessage('Could not fetch video title'));

    // Load YouTube API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    let ytPlayer, ytInterval;
    window.onYouTubeIframeAPIReady = function(){
      ytPlayer = new YT.Player('youtubePlayer', {
        videoId: id,
        playerVars: { controls: 0, modestbranding: 1, rel: 0 },
        events: {
          onReady: () => {
            showMessage('YouTube audio loaded. Use the custom buttons.');
            ytDurationEl.textContent = formatTime(ytPlayer.getDuration());

            ytInterval = setInterval(()=>{
              if(ytPlayer && ytPlayer.getCurrentTime){
                const cur = ytPlayer.getCurrentTime();
                const dur = ytPlayer.getDuration();
                ytCurrentTimeEl.textContent = formatTime(cur);
                ytDurationEl.textContent = formatTime(dur);
                ytProgressFill.style.width = (cur/dur*100)+'%';
              }
            }, 1000);
          }
        }
      });
      ...
    }
  }
}

              // update progress bar every second
              ytInterval = setInterval(()=>{
                if(ytPlayer && ytPlayer.getCurrentTime){
                  const cur = ytPlayer.getCurrentTime();
                  const dur = ytPlayer.getDuration();
                  ytCurrentTimeEl.textContent = formatTime(cur);
                  ytDurationEl.textContent = formatTime(dur);
                  ytProgressFill.style.width = (cur/dur*100)+'%';
                }
              }, 1000);
            }
          }
        });

        const playPauseBtn = document.getElementById('ytPlayPause');
        playPauseBtn.addEventListener('click', () => {
          const state = ytPlayer.getPlayerState();
          if(state === YT.PlayerState.PLAYING){
            ytPlayer.pauseVideo();
            playPauseBtn.textContent = '‚ñ∂ Play';
          } else {
            ytPlayer.playVideo();
            playPauseBtn.textContent = '‚è∏ Pause';
          }
        });

        document.getElementById('ytRewind').addEventListener('click', () => {
          ytPlayer.seekTo(Math.max(0, ytPlayer.getCurrentTime() - 10), true);
        });

        document.getElementById('ytForward').addEventListener('click', () => {
          ytPlayer.seekTo(ytPlayer.getCurrentTime() + 10, true);
        });

        ytProgressBar.addEventListener('click', (e) => {
          const rect = ytProgressBar.getBoundingClientRect();
          const pct = (e.clientX - rect.left) / rect.width;
          ytPlayer.seekTo(pct * ytPlayer.getDuration(), true);
        });
      };
    }
  }

  // ---- MP3 helpers ----
  function initMp3Controls(){
    playBtn.addEventListener('click', ()=> audio.paused ? audio.play() : audio.pause());
    stopBtn.addEventListener('click', ()=> { audio.pause(); audio.currentTime = 0; });
    audio.addEventListener('timeupdate', onTimeUpdate);
    audio.addEventListener('loadedmetadata', ()=> durationEl.textContent = formatTime(audio.duration));
    audio.addEventListener('play', ()=> playBtn.textContent = '‚è∏ Pause');
    audio.addEventListener('pause', ()=> playBtn.textContent = '‚ñ∂ Play');
    progressBar.addEventListener('click', (e)=> {
      const r = progressBar.getBoundingClientRect();
      const pct = (e.clientX - r.left) / r.width;
      audio.currentTime = pct * audio.duration;
    });
  }

  function onTimeUpdate(){
    const pct = (audio.currentTime / audio.duration) * 100;
    progressFill.style.width = pct + '%';
    currentTimeEl.textContent = formatTime(audio.currentTime);
    durationEl.textContent = formatTime(audio.duration);
  }

  function formatTime(s){
    s = Math.floor(s)||0;
    return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');
  }
</script>
</body>
</html>
